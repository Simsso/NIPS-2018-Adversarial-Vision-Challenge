{
    "steps": [
        {
            "name":"gcr.io/cloud-builders/docker",
            "args": [
                "build",
                "-t",
                "gcr.io/$PROJECT_ID/$TAG_NAME:$SHORT_SHA",
                "models/$TAG_NAME"
            ]
        },
        {
            "name":"gcr.io/cloud-builders/docker",
            "args": [
                "push",
                "gcr.io/$PROJECT_ID/$TAG_NAME:$SHORT_SHA"
            ]
        },
        {
            "name":"gcr.io/cloud-builders/gcloud",
            "args": [
                "kms",
                "decrypt",
                "--ciphertext-file=deployment/cloudbuild-service-account.json.enc",
                "--plaintext-file=deployment/cloudbuild-service-account.json",
                "--location=global",
                "--keyring=nips-2018-challenge-keyring",
                "--key=nips-2018-challenge-key"
            ]
        },
        {
            "name":"gcr.io/cloud-builders/gcloud",
            "args": [
                "kms",
                "decrypt",
                "--ciphertext-file=deployment/nips-cloudbuilder.enc",
                "--plaintext-file=deployment/nips-cloudbuilder",
                "--location=global",
                "--keyring=nips-2018-challenge-keyring",
                "--key=nips-2018-challenge-key"
            ]
        },
        {
            "name": "ubuntu",
            "args": [
                "bash",
                "deployment/create_gce_instance.sh",
                "$TAG_NAME-$SHORT_SHA"
            ] 
        }
    ]
}